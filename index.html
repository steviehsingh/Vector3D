<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Vector Database Demo</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a0a0a;
            color: white;
            font-family: 'Monaco', 'Courier New', monospace;
            line-height: 1.6;
            overflow-x: auto;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            color: #00ff88;
        }
        .section-title {
            font-size: 20px;
            color: #ff6b6b;
            margin: 40px 0 20px 0;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        .triple-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .panel {
            background: #111;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
        }
        .panel-title {
            font-size: 16px;
            margin-bottom: 15px;
            color: #00ff88;
            text-align: center;
        }
        .document-panel {
            grid-column: 1 / -1;
            margin-bottom: 20px;
        }
        .document-text {
            background: #222;
            padding: 15px;
            border-radius: 4px;
            font-size: 14px;
            line-height: 1.8;
            margin-bottom: 15px;
        }
        .chunk {
            display: inline;
            padding: 2px 4px;
            border-radius: 3px;
            margin: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .chunk:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }
        .chunk-0 { background: rgba(255, 107, 107, 0.3); border: 1px solid #ff6b6b; }
        .chunk-1 { background: rgba(77, 171, 247, 0.3); border: 1px solid #4dabf7; }
        .chunk-2 { background: rgba(105, 219, 124, 0.3); border: 1px solid #69db7c; }
        .chunk-3 { background: rgba(255, 212, 59, 0.3); border: 1px solid #ffd43b; }
        .chunk-4 { background: rgba(151, 117, 250, 0.3); border: 1px solid #9775fa; }
        .chunk-5 { background: rgba(255, 146, 146, 0.3); border: 1px solid #ff9292; }
        .chunk-6 { background: rgba(116, 202, 255, 0.3); border: 1px solid #74caff; }
        
        svg {
            width: 100%;
            background: #000;
            border-radius: 4px;
            border: 1px solid #333;
        }
        .small-svg { height: 300px; }
        .medium-svg { height: 400px; }
        .large-svg { height: 500px; }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .control-btn {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        .control-btn:hover {
            background: #555;
            border-color: #00ff88;
        }
        .control-btn.active {
            background: #00ff88;
            color: black;
        }
        
        .chunk-details {
            background: #222;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            min-height: 100px;
        }
        .chunk-text {
            color: #00ff88;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .vector-coords {
            font-size: 12px;
            color: #888;
            font-family: monospace;
        }
        
        .query-section {
            margin-bottom: 20px;
        }
        .query-input {
            width: 100%;
            background: #222;
            color: white;
            border: 1px solid #555;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .query-btn {
            background: #00ff88;
            color: black;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .results {
            background: #222;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }
        .result-item {
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid;
            cursor: pointer;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            font-size: 12px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .legend-dot.large {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        
        .notes {
            background: #111;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .notes h3 {
            color: #ff6b6b;
            margin-top: 0;
        }
        .notes ul {
            line-height: 1.6;
        }
        
        .comparison-note {
            background: #1a1a2e;
            border: 2px solid #16213e;
            border-radius: 8px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
        }
        .comparison-note h3 {
            color: #ffd43b;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">Complete Vector Database Demonstration</div>
        
        <!-- Section 1: Text to Embeddings -->
        <div class="section-title">Part 1: From Text to Vector Embeddings</div>
        
        <div class="panel document-panel">
            <div class="panel-title">1. Source Document → Text Chunks</div>
            <div class="document-text" id="source-document">
                <!-- Document content will be inserted here -->
            </div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot large chunk-0"></div>
                    <span>Technology Focus</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot large chunk-1"></div>
                    <span>AI/Machine Learning</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot large chunk-2"></div>
                    <span>Business Impact</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot large chunk-3"></div>
                    <span>Future/Innovation</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot large chunk-4"></div>
                    <span>Data/Analytics</span>
                </div>
            </div>
        </div>
        
        <div class="demo-grid">
            <div class="panel">
                <div class="panel-title">2. Chunks → 2D Vector Space</div>
                <div class="controls">
                    <button class="control-btn active" onclick="showMode('semantic')">Semantic View</button>
                    <button class="control-btn" onclick="showMode('similarity')">Similarity Search</button>
                    <button class="control-btn" onclick="showMode('clustering')">Show Clusters</button>
                </div>
                <svg id="vector-space" class="medium-svg"></svg>
                <div class="chunk-details" id="chunk-info">
                    <div style="color: #888;">Click on a chunk in the document or vector space to see details</div>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-title">3. Semantic Search Demo</div>
                <div class="query-section">
                    <input type="text" class="query-input" id="query-input" placeholder="Enter search query (e.g., 'machine learning', 'business transformation')">
                    <button class="query-btn" onclick="performSearch()">Search Similar Chunks</button>
                </div>
                <div class="results" id="search-results">
                    <div style="color: #888;">Enter a search query above to find semantically similar text chunks</div>
                </div>
            </div>
        </div>
        
        <div class="comparison-note">
            <h3>⚠️ Important: Real vs Simplified</h3>
            <p>The above shows a <strong>simplified 2D representation</strong> for learning purposes. Real vector embeddings use 768-1536 dimensions, where semantic similarity behaves very differently. Below we show what <strong>realistic vector database behavior</strong> looks like...</p>
        </div>
        
        <!-- Section 2: Realistic Vector Database Behavior -->
        <div class="section-title">Part 2: Realistic Vector Database Data Distribution</div>
        
        <div class="demo-grid">
            <div class="panel">
                <div class="panel-title">Overlapping Clusters with Outliers</div>
                <svg id="realistic-clusters" class="small-svg"></svg>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #ff6b6b;"></div>
                        <span>Text Documents</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #4dabf7;"></div>
                        <span>Product Descriptions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #69db7c;"></div>
                        <span>User Queries</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #ffd43b;"></div>
                        <span>Code Snippets</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #9775fa;"></div>
                        <span>Mixed/Edge Cases</span>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-title">High-Dimensional Projection Effects</div>
                <svg id="projection-effects" class="small-svg"></svg>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-dot" style="background: rgba(255, 107, 107, 0.8);"></div>
                        <span>Core embeddings</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: rgba(255, 107, 107, 0.3);"></div>
                        <span>Similar variants</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot" style="background: #666;"></div>
                        <span>Noise/Low confidence</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <div class="panel-title">ANN Algorithm Comparison: Brute Force vs HNSW vs IVF</div>
            <svg id="similarity-comparison" class="large-svg"></svg>
            <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #888;">
                Click to place query point and see different search strategies
            </div>
            <div class="legend" style="justify-content: center; margin-top: 15px;">
                <div class="legend-item">
                    <div class="legend-dot" style="background: #ff6b6b;"></div>
                    <span>Query Point</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #00ff88;"></div>
                    <span>True Nearest (Brute Force)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #4dabf7;"></div>
                    <span>HNSW Path</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #ffd43b;"></div>
                    <span>IVF Candidates</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #9775fa;"></div>
                    <span>Grid Buckets (IVF)</span>
                </div>
            </div>
        </div>
        
        <div class="notes">
            <h3>Key Insights from This Complete Demo:</h3>
            <ul>
                <li><strong>2D Simplification vs Reality:</strong> The chunking demo uses 2D for learning, but real embeddings are 768+ dimensional with very different behavior</li>
                <li><strong>Overlapping Boundaries:</strong> Real clusters blend into each other with fuzzy boundaries, not clean separations</li>
                <li><strong>Varying Densities:</strong> Some regions are dense with similar data, others are sparse with outliers</li>
                <li><strong>High-Dimensional Effects:</strong> Most points appear roughly equidistant when you have hundreds of dimensions</li>
                <li><strong>ANN Trade-offs:</strong> HNSW follows graph paths (fast but may miss optimal), IVF checks grid cells (medium speed), Brute force is exact but slow</li>
                <li><strong>Performance vs Accuracy:</strong> Production systems sacrifice 5-10% accuracy for massive speed improvements</li>
                <li><strong>Search Strategy Impact:</strong> Different algorithms can return different "similar" results for the same query</li>
                <li><strong>Real-World Messiness:</strong> Production data includes noise, edge cases, and ambiguous content that doesn't fit neatly into categories</li>
            </ul>
        </div>
    </div>

    <script>
        // Sample document with realistic content
        const documentText = `
        Artificial intelligence is transforming modern businesses through automation and data-driven insights. Companies are leveraging machine learning algorithms to optimize operations and improve customer experiences.

        The integration of AI systems requires careful planning and substantial investment in infrastructure. Organizations must consider data quality, model training, and deployment strategies when implementing these technologies.

        Machine learning models can analyze vast datasets to identify patterns and predict future trends. This capability enables businesses to make informed decisions and gain competitive advantages in their markets.

        Data scientists use various techniques including supervised learning, unsupervised learning, and deep neural networks to solve complex business problems. These approaches help extract meaningful insights from structured and unstructured data.

        The future of AI development focuses on explainable algorithms, ethical considerations, and sustainable computing practices. Companies are investing in responsible AI frameworks to ensure transparent and fair decision-making processes.

        Advanced analytics platforms integrate multiple data sources to provide comprehensive business intelligence. These systems enable real-time monitoring, predictive modeling, and automated reporting capabilities.

        Cloud computing infrastructure supports scalable AI deployments, allowing organizations to process large volumes of data efficiently. This technological foundation enables rapid experimentation and model iteration.
        `;

        // Define chunks with semantic categorization
        const chunks = [
            {
                id: 0,
                text: "Artificial intelligence is transforming modern businesses through automation and data-driven insights. Companies are leveraging machine learning algorithms to optimize operations and improve customer experiences.",
                category: "AI/Business",
                vector: { x: 150, y: 100 },
                keywords: ["AI", "automation", "business transformation", "machine learning", "customer experience"]
            },
            {
                id: 1,
                text: "The integration of AI systems requires careful planning and substantial investment in infrastructure. Organizations must consider data quality, model training, and deployment strategies.",
                category: "Implementation",
                vector: { x: 280, y: 150 },
                keywords: ["AI implementation", "infrastructure", "planning", "deployment", "strategy"]
            },
            {
                id: 2,
                text: "Machine learning models can analyze vast datasets to identify patterns and predict future trends. This capability enables businesses to make informed decisions and gain competitive advantages.",
                category: "ML/Analytics",
                vector: { x: 200, y: 250 },
                keywords: ["machine learning", "data analysis", "pattern recognition", "prediction", "competitive advantage"]
            },
            {
                id: 3,
                text: "Data scientists use various techniques including supervised learning, unsupervised learning, and deep neural networks to solve complex business problems.",
                category: "Data Science",
                vector: { x: 350, y: 200 },
                keywords: ["data science", "supervised learning", "neural networks", "problem solving", "techniques"]
            },
            {
                id: 4,
                text: "The future of AI development focuses on explainable algorithms, ethical considerations, and sustainable computing practices. Companies are investing in responsible AI frameworks.",
                category: "Future/Ethics",
                vector: { x: 120, y: 300 },
                keywords: ["future AI", "ethics", "explainable AI", "sustainability", "responsible AI"]
            },
            {
                id: 5,
                text: "Advanced analytics platforms integrate multiple data sources to provide comprehensive business intelligence. These systems enable real-time monitoring and automated reporting.",
                category: "Analytics",
                vector: { x: 320, y: 320 },
                keywords: ["analytics platforms", "business intelligence", "real-time", "reporting", "integration"]
            },
            {
                id: 6,
                text: "Cloud computing infrastructure supports scalable AI deployments, allowing organizations to process large volumes of data efficiently. This enables rapid experimentation and model iteration.",
                category: "Infrastructure",
                vector: { x: 250, y: 80 },
                keywords: ["cloud computing", "scalability", "infrastructure", "data processing", "experimentation"]
            }
        ];

        let currentMode = 'semantic';
        let selectedChunk = null;

        // Initialize all visualizations
        function initializeVisualization() {
            renderDocument();
            renderVectorSpace();
            initializeRealisticVisualizations();
        }

        // Render the document with highlighted chunks
        function renderDocument() {
            const container = document.getElementById('source-document');
            let html = '';
            let currentPos = 0;

            chunks.forEach((chunk, index) => {
                const chunkStart = documentText.indexOf(chunk.text, currentPos);
                if (chunkStart !== -1) {
                    // Add text before chunk
                    html += documentText.substring(currentPos, chunkStart);
                    
                    // Add highlighted chunk
                    html += `<span class="chunk chunk-${index % 7}" onclick="selectChunk(${chunk.id})" title="Click to see vector details">${chunk.text}</span>`;
                    
                    currentPos = chunkStart + chunk.text.length;
                }
            });

            // Add remaining text
            html += documentText.substring(currentPos);
            container.innerHTML = html;
        }

        // Render the simplified 2D vector space
        function renderVectorSpace() {
            const svg = document.getElementById('vector-space');
            const width = svg.clientWidth;
            const height = svg.clientHeight;
            
            svg.innerHTML = '';

            // Add grid
            for (let i = 0; i <= 10; i++) {
                const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line1.setAttribute('x1', (i * width / 10));
                line1.setAttribute('y1', 0);
                line1.setAttribute('x2', (i * width / 10));
                line1.setAttribute('y2', height);
                line1.setAttribute('stroke', '#333');
                line1.setAttribute('stroke-width', 1);
                line1.setAttribute('opacity', 0.3);
                svg.appendChild(line1);

                const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line2.setAttribute('x1', 0);
                line2.setAttribute('y1', (i * height / 10));
                line2.setAttribute('x2', width);
                line2.setAttribute('y2', (i * height / 10));
                line2.setAttribute('stroke', '#333');
                line2.setAttribute('stroke-width', 1);
                line2.setAttribute('opacity', 0.3);
                svg.appendChild(line2);
            }

            // Add axis labels
            const xLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            xLabel.setAttribute('x', width - 120);
            xLabel.setAttribute('y', height - 10);
            xLabel.setAttribute('fill', '#888');
            xLabel.setAttribute('font-size', '12');
            xLabel.textContent = 'Technical Complexity →';
            svg.appendChild(xLabel);

            const yLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            yLabel.setAttribute('x', 10);
            yLabel.setAttribute('y', 20);
            yLabel.setAttribute('fill', '#888');
            yLabel.setAttribute('font-size', '12');
            yLabel.textContent = '↑ Business Focus';
            svg.appendChild(yLabel);

            // Render chunks as points
            chunks.forEach((chunk, index) => {
                const colors = ['#ff6b6b', '#4dabf7', '#69db7c', '#ffd43b', '#9775fa', '#ff9292', '#74caff'];
                const color = colors[index % colors.length];
                
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', chunk.vector.x);
                circle.setAttribute('cy', chunk.vector.y);
                circle.setAttribute('r', selectedChunk === chunk.id ? 8 : 6);
                circle.setAttribute('fill', color);
                circle.setAttribute('stroke', selectedChunk === chunk.id ? '#fff' : 'none');
                circle.setAttribute('stroke-width', 2);
                circle.setAttribute('opacity', 0.9);
                circle.style.cursor = 'pointer';
                circle.onclick = () => selectChunk(chunk.id);
                svg.appendChild(circle);

                // Add chunk label
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', chunk.vector.x + 10);
                text.setAttribute('y', chunk.vector.y + 5);
                text.setAttribute('fill', color);
                text.setAttribute('font-size', '10');
                text.setAttribute('font-weight', 'bold');
                text.textContent = `Chunk ${index + 1}`;
                svg.appendChild(text);

                // Show connections in clustering mode
                if (currentMode === 'clustering') {
                    chunks.forEach((otherChunk, otherIndex) => {
                        if (index !== otherIndex) {
                            const distance = Math.sqrt(
                                Math.pow(chunk.vector.x - otherChunk.vector.x, 2) +
                                Math.pow(chunk.vector.y - otherChunk.vector.y, 2)
                            );
                            
                            if (distance < 120) {
                                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                                line.setAttribute('x1', chunk.vector.x);
                                line.setAttribute('y1', chunk.vector.y);
                                line.setAttribute('x2', otherChunk.vector.x);
                                line.setAttribute('y2', otherChunk.vector.y);
                                line.setAttribute('stroke', '#555');
                                line.setAttribute('stroke-width', 1);
                                line.setAttribute('opacity', 0.5);
                                svg.appendChild(line);
                            }
                        }
                    });
                }
            });
        }

        // Select a chunk and show details
        function selectChunk(chunkId) {
            selectedChunk = chunkId;
            const chunk = chunks.find(c => c.id === chunkId);
            
            if (chunk) {
                const infoDiv = document.getElementById('chunk-info');
                infoDiv.innerHTML = `
                    <div class="chunk-text">Chunk ${chunkId + 1}: ${chunk.category}</div>
                    <div style="margin-bottom: 10px; font-size: 13px;">"${chunk.text.substring(0, 100)}..."</div>
                    <div class="vector-coords">
                        <strong>2D Vector Position:</strong> (${chunk.vector.x}, ${chunk.vector.y})<br>
                        <strong>Keywords:</strong> ${chunk.keywords.join(', ')}<br>
                        <strong>Semantic Category:</strong> ${chunk.category}<br>
                        <em>Note: Real embeddings use 768+ dimensions, not just X,Y!</em>
                    </div>
                `;
            }
            
            renderVectorSpace();
        }

        // Show different visualization modes
        function showMode(mode) {
            currentMode = mode;
            
            // Update button states
            document.querySelectorAll('.control-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            renderVectorSpace();
        }

        // Perform semantic search
        function performSearch() {
            const query = document.getElementById('query-input').value.toLowerCase();
            if (!query.trim()) return;

            const results = chunks.map(chunk => {
                const queryWords = query.split(' ');
                const chunkText = chunk.text.toLowerCase();
                const keywords = chunk.keywords.map(k => k.toLowerCase());
                
                let score = 0;
                queryWords.forEach(word => {
                    if (chunkText.includes(word)) score += 3;
                    keywords.forEach(keyword => {
                        if (keyword.includes(word) || word.includes(keyword.split(' ')[0])) score += 2;
                    });
                });
                
                return { chunk, score };
            })
            .filter(r => r.score > 0)
            .sort((a, b) => b.score - a.score);

            const resultsDiv = document.getElementById('search-results');
            if (results.length === 0) {
                resultsDiv.innerHTML = '<div style="color: #888;">No similar chunks found. Try terms like "machine learning", "business", "data", or "AI"</div>';
                return;
            }

            resultsDiv.innerHTML = results.map((result, index) => {
                const colors = ['#ff6b6b', '#4dabf7', '#69db7c', '#ffd43b', '#9775fa'];
                return `
                    <div class="result-item" style="border-left-color: ${colors[result.chunk.id % colors.length]};" onclick="selectChunk(${result.chunk.id})">
                        <div style="font-weight: bold; margin-bottom: 5px;">Chunk ${result.chunk.id + 1} - Similarity: ${Math.round((result.score / 10) * 100)}%</div>
                        <div style="font-size: 12px; color: #ccc;">"${result.chunk.text.substring(0, 120)}..."</div>
                    </div>
                `;
            }).join('');
        }

        // === REALISTIC VECTOR DATABASE VISUALIZATIONS ===

        // Initialize realistic visualizations
        function initializeRealisticVisualizations() {
            generateRealisticClusters();
            generateProjectionEffects();
            generateAdvancedSimilarityComparison();
        }

        // Generate realistic cluster data with overlaps
        function generateRealisticClusters() {
            const svg = document.getElementById('realistic-clusters');
            const width = svg.clientWidth;
            const height = svg.clientHeight;
            
            svg.innerHTML = '';
            
            const clusters = [
                { x: width * 0.3, y: height * 0.3, color: '#ff6b6b', size: 80, density: 0.7 },
                { x: width * 0.7, y: height * 0.4, color: '#4dabf7', size: 60, density: 0.8 },
                { x: width * 0.5, y: height * 0.7, color: '#69db7c', size: 70, density: 0.6 },
                { x: width * 0.2, y: height * 0.8, color: '#ffd43b', size: 50, density: 0.9 },
                { x: width * 0.8, y: height * 0.2, color: '#9775fa', size: 40, density: 0.5 }
            ];
            
            clusters.forEach((cluster, i) => {
                const numPoints = Math.floor(cluster.size * cluster.density);
                for (let j = 0; j < numPoints; j++) {
                    let x, y;
                    if (i < 2) {
                        const angle = Math.random() * Math.PI * 2;
                        const radius = Math.abs(gaussianRandom()) * 60 + 20;
                        x = cluster.x + Math.cos(angle) * radius;
                        y = cluster.y + Math.sin(angle) * radius;
                    } else {
                        x = cluster.x + (Math.random() - 0.5) * 120;
                        y = cluster.y + (Math.random() - 0.5) * 120;
                    }
                    
                    if (Math.random() < 0.1) {
                        x += (Math.random() - 0.5) * 200;
                        y += (Math.random() - 0.5) * 200;
                    }
                    
                    const opacity = Math.random() * 0.6 + 0.4;
                    const size = Math.random() * 3 + 1;
                    
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', Math.max(5, Math.min(width - 5, x)));
                    circle.setAttribute('cy', Math.max(5, Math.min(height - 5, y)));
                    circle.setAttribute('r', size);
                    circle.setAttribute('fill', cluster.color);
                    circle.setAttribute('opacity', opacity);
                    svg.appendChild(circle);
                }
            });
        }
        
        // Generate projection effects visualization
        function generateProjectionEffects() {
            const svg = document.getElementById('projection-effects');
            const width = svg.clientWidth;
            const height = svg.clientHeight;
            
            svg.innerHTML = '';
            
            const centers = [
                { x: width * 0.4, y: height * 0.3 },
                { x: width * 0.6, y: height * 0.7 },
                { x: width * 0.8, y: height * 0.4 }
            ];
            
            centers.forEach((center, i) => {
                for (let j = 0; j < 15; j++) {
                    const angle = Math.random() * Math.PI * 2;
                    const radius = Math.abs(gaussianRandom()) * 25;
                    const x = center.x + Math.cos(angle) * radius;
                    const y = center.y + Math.sin(angle) * radius;
                    
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', x);
                    circle.setAttribute('cy', y);
                    circle.setAttribute('r', 2.5);
                    circle.setAttribute('fill', '#ff6b6b');
                    circle.setAttribute('opacity', 0.8);
                    svg.appendChild(circle);
                }
                
                for (let j = 0; j < 25; j++) {
                    const angle = Math.random() * Math.PI * 2;
                    const radius = Math.abs(gaussianRandom()) * 60 + 30;
                    const x = center.x + Math.cos(angle) * radius;
                    const y = center.y + Math.sin(angle) * radius;
                    
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', Math.max(2, Math.min(width - 2, x)));
                    circle.setAttribute('cy', Math.max(2, Math.min(height - 2, y)));
                    circle.setAttribute('r', 1.5);
                    circle.setAttribute('fill', '#ff6b6b');
                    circle.setAttribute('opacity', 0.3);
                    svg.appendChild(circle);
                }
            });
            
            for (let i = 0; i < 30; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', x);
                circle.setAttribute('cy', y);
                circle.setAttribute('r', 1);
                circle.setAttribute('fill', '#666');
                circle.setAttribute('opacity', 0.6);
                svg.appendChild(circle);
            }
        }

        // Advanced ANN algorithms visualization
        function generateAdvancedSimilarityComparison() {
            const svg = document.getElementById('similarity-comparison');
            const width = svg.clientWidth;
            const height = svg.clientHeight;
            
            svg.innerHTML = '';
            
            const points = [];
            const clusters = [
                { x: width * 0.2, y: height * 0.3, count: 25 },
                { x: width * 0.7, y: height * 0.2, count: 20 },
                { x: width * 0.5, y: height * 0.7, count: 30 },
                { x: width * 0.8, y: height * 0.6, count: 15 }
            ];
            
            let pointId = 0;
            clusters.forEach(cluster => {
                for (let i = 0; i < cluster.count; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const radius = Math.abs(gaussianRandom()) * 40 + 10;
                    points.push({
                        x: Math.max(10, Math.min(width - 10, cluster.x + Math.cos(angle) * radius)),
                        y: Math.max(10, Math.min(height - 10, cluster.y + Math.sin(angle) * radius)),
                        id: pointId++,
                        cluster: cluster
                    });
                }
            });
            
            for (let i = 0; i < 20; i++) {
                points.push({
                    x: Math.random() * (width - 20) + 10,
                    y: Math.random() * (height - 20) + 10,
                    id: pointId++,
                    cluster: null
                });
            }
            
            function buildHNSWGraph() {
                const graph = {};
                points.forEach(point => {
                    graph[point.id] = [];
                });
                
                points.forEach(point => {
                    const distances = points
                        .filter(p => p.id !== point.id)
                        .map(p => ({
                            point: p,
                            dist: Math.sqrt((p.x - point.x) ** 2 + (p.y - point.y) ** 2)
                        }))
                        .sort((a, b) => a.dist - b.dist)
                        .slice(0, Math.min(6, points.length - 1));
                    
                    graph[point.id] = distances.map(d => d.point.id);
                });
                
                return graph;
            }
            
            function createIVFGrid() {
                const gridSize = 4;
                const cellWidth = width / gridSize;
                const cellHeight = height / gridSize;
                
                points.forEach(point => {
                    const cellX = Math.floor(point.x / cellWidth);
                    const cellY = Math.floor(point.y / cellHeight);
                    point.ivfCell = `${cellX},${cellY}`;
                });
            }
            
            const hnswGraph = buildHNSWGraph();
            createIVFGrid();
            
            let queryX = width * 0.4;
            let queryY = height * 0.4;
            
            function updateVisualization(qx, qy) {
                svg.innerHTML = '';
                
                const distances = points.map(point => ({
                    point,
                    dist: Math.sqrt((point.x - qx) ** 2 + (point.y - qy) ** 2)
                })).sort((a, b) => a.dist - b.dist);
                
                const trueNearest = distances.slice(0, 5);
                
                let hnswPath = [];
                if (distances.length > 0) {
                    let current = distances[0].point;
                    hnswPath.push(current);
                    
                    for (let i = 0; i < 3; i++) {
                        const neighbors = hnswGraph[current.id] || [];
                        if (neighbors.length > 0) {
                            const nextId = neighbors[Math.floor(Math.random() * Math.min(2, neighbors.length))];
                            current = points.find(p => p.id === nextId);
                            if (current) hnswPath.push(current);
                        }
                    }
                }
                
                const queryCell = Math.floor(qx / (width / 4)) + ',' + Math.floor(qy / (height / 4));
                const ivfCandidates = points.filter(p => p.ivfCell === queryCell);
                
                // Draw IVF grid
                for (let i = 0; i <= 4; i++) {
                    const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line1.setAttribute('x1', (i * width / 4));
                    line1.setAttribute('y1', 0);
                    line1.setAttribute('x2', (i * width / 4));
                    line1.setAttribute('y2', height);
                    line1.setAttribute('stroke', '#9775fa');
                    line1.setAttribute('stroke-width', 1);
                    line1.setAttribute('opacity', 0.3);
                    svg.appendChild(line1);
                    
                    const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line2.setAttribute('x1', 0);
                    line2.setAttribute('y1', (i * height / 4));
                    line2.setAttribute('x2', width);
                    line2.setAttribute('y2', (i * height / 4));
                    line2.setAttribute('stroke', '#9775fa');
                    line2.setAttribute('stroke-width', 1);
                    line2.setAttribute('opacity', 0.3);
                    svg.appendChild(line2);
                }
                
                // Draw all points
                points.forEach(point => {
                    let color = '#666';
                    let size = 2;
                    let opacity = 0.6;
                    
                    if (trueNearest.some(n => n.point.id === point.id)) {
                        color = '#00ff88';
                        size = 4;
                        opacity = 1;
                    } else if (hnswPath.some(p => p.id === point.id)) {
                        color = '#4dabf7';
                        size = 3;
                        opacity = 0.8;
                    } else if (ivfCandidates.some(p => p.id === point.id)) {
                        color = '#ffd43b';
                        size = 3;
                        opacity = 0.7;
                    }
                    
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', point.x);
                    circle.setAttribute('cy', point.y);
                    circle.setAttribute('r', size);
                    circle.setAttribute('fill', color);
                    circle.setAttribute('opacity', opacity);
                    svg.appendChild(circle);
                });
                
                // Draw HNSW path
                for (let i = 0; i < hnswPath.length - 1; i++) {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', hnswPath[i].x);
                    line.setAttribute('y1', hnswPath[i].y);
                    line.setAttribute('x2', hnswPath[i + 1].x);
                    line.setAttribute('y2', hnswPath[i + 1].y);
                    line.setAttribute('stroke', '#4dabf7');
                    line.setAttribute('stroke-width', 2);
                    line.setAttribute('opacity', 0.8);
                    svg.appendChild(line);
                }
                
                // Draw lines to true nearest neighbors
                trueNearest.forEach(n => {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', qx);
                    line.setAttribute('y1', qy);
                    line.setAttribute('x2', n.point.x);
                    line.setAttribute('y2', n.point.y);
                    line.setAttribute('stroke', '#00ff88');
                    line.setAttribute('stroke-width', 1);
                    line.setAttribute('opacity', 0.5);
                    svg.appendChild(line);
                });
                
                // Draw query point
                const queryCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                queryCircle.setAttribute('cx', qx);
                queryCircle.setAttribute('cy', qy);
                queryCircle.setAttribute('r', 6);
                queryCircle.setAttribute('fill', '#ff6b6b');
                queryCircle.setAttribute('stroke', '#fff');
                queryCircle.setAttribute('stroke-width', 2);
                svg.appendChild(queryCircle);
                
                // Add performance stats
                const statsText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                statsText.setAttribute('x', 10);
                statsText.setAttribute('y', 20);
                statsText.setAttribute('fill', '#00ff88');
                statsText.setAttribute('font-size', '12');
                statsText.textContent = `Brute Force: ${points.length} comparisons | HNSW: ~${hnswPath.length * 6} | IVF: ${ivfCandidates.length} candidates`;
                svg.appendChild(statsText);
            }
            
            updateVisualization(queryX, queryY);
            
            svg.addEventListener('click', (e) => {
                const rect = svg.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                queryX = x;
                queryY = y;
                updateVisualization(x, y);
            });
        }

        // Gaussian random number generator
        function gaussianRandom() {
            let u = 0, v = 0;
            while(u === 0) u = Math.random();
            while(v === 0) v = Math.random();
            return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        }

        // Initialize on page load
        window.addEventListener('load', initializeVisualization);
        window.addEventListener('resize', () => {
            renderVectorSpace();
            generateRealisticClusters();
            generateProjectionEffects();
            generateAdvancedSimilarityComparison();
        });

        // Regenerate realistic visualizations periodically
        setInterval(() => {
            generateRealisticClusters();
            generateProjectionEffects();
        }, 5000);

        // Add sample queries for demonstration
        document.getElementById('query-input').addEventListener('focus', function() {
            if (this.value === '') {
                this.placeholder = 'Try: "machine learning applications", "business transformation", "data analysis"';
            }
        });
    </script>
</body>
</html>